<ion-content>
  <ion-card class="sme-form-card ion-no-margin">
    <ion-card-header>
      <ion-card-title>
        {{
          mode === 'create'
            ? 'Product Details'
            : mode === 'update'
            ? 'Edit Product Details'
            : 'Product Details'
        }}
      </ion-card-title>
      <ion-card-subtitle *ngIf="mode !== 'read'">Please fill all required information</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <ion-item lines="none" color="danger" *ngIf="formLevelErrors.length > 0 && mode !== 'read'">
          <ion-label>
            <p *ngFor="let message of formLevelErrors">{{ message }}</p>
          </ion-label>
        </ion-item>
        <ion-grid>

        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="text" formControlName="productId" label="Product ID" label-placement="floating" readonly></ion-input>
            </ion-item>
            <ion-note color="medium" *ngIf="mode === 'create'">Generated automatically after creation.</ion-note>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="text" formControlName="productName" label="Product Name *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['productName'].invalid && (f['productName'].dirty || f['productName'].touched) && mode !== 'read'">
              <small *ngIf="f['productName'].errors?.['required']">Product Name is required.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('productName') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('productName')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-select formControlName="rawMaterial" label="Raw Material *" label-placement="floating" [disabled]="mode === 'read'" required>
                <ion-select-option *ngFor="let rm of rawMaterials" [value]="rm">{{rm}}</ion-select-option>
              </ion-select>
            </ion-item>
            <ion-text color="danger" *ngIf="f['rawMaterial'].invalid && (f['rawMaterial'].dirty || f['rawMaterial'].touched) && mode !== 'read'">
              <small *ngIf="f['rawMaterial'].errors?.['required']">Raw Material is required.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('rawMaterial') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('rawMaterial')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Sales Type -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-select formControlName="salesType" label="Sales Type *" label-placement="floating" [disabled]="mode === 'read'">
                <ion-select-option *ngFor="let type of salesTypeOptions" [value]="type">{{ type }}</ion-select-option>
              </ion-select>
            </ion-item>
            <ion-text color="danger" *ngIf="f['salesType'].invalid && (f['salesType'].dirty || f['salesType'].touched) && mode !== 'read'">
              <small *ngIf="f['salesType'].errors?.['required']">Sales Type is required.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('salesType') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('salesType')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Sales Code -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input
                type="text"
                formControlName="salesCode"
                label="Sales / HSN Code *"
                label-placement="floating"
                [readonly]="mode === 'read'">
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['salesCode'].invalid && (f['salesCode'].dirty || f['salesCode'].touched) && mode !== 'read'">
              <small *ngIf="f['salesCode'].errors?.['required']">Sales Code is required.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('salesCode') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('salesCode')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Sales Percentage -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="salesPercentage" label="Sales % *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['salesPercentage'].invalid && (f['salesPercentage'].dirty || f['salesPercentage'].touched) && mode !== 'read'">
              <small *ngIf="f['salesPercentage'].errors?.['required']">Sales % is required.</small>
              <small *ngIf="f['salesPercentage'].errors?.['min']">Sales % must be >= 0.</small>
              <small *ngIf="f['salesPercentage'].errors?.['max']">Sales % must be <= 100.</small>
              <small *ngIf="f['salesPercentage'].errors?.['pattern']">Sales % must be a valid number.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('salesPercentage') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('salesPercentage')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Weight -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="weight" label="Weight *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['weight'].invalid && (f['weight'].dirty || f['weight'].touched) && mode !== 'read'">
              <small *ngIf="f['weight'].errors?.['required']">Weight is required.</small>
              <small *ngIf="f['weight'].errors?.['min']">Weight must be >= 0.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('weight') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('weight')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Wastage -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" formControlName="wastage" label="Wastage (%) *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['wastage'].invalid && (f['wastage'].dirty || f['wastage'].touched) && mode !== 'read'">
              <small *ngIf="f['wastage'].errors?.['required']">Wastage is required.</small>
              <small *ngIf="f['wastage'].errors?.['min']">Wastage must be >= 0.</small>
              <small *ngIf="f['wastage'].errors?.['pattern']">Wastage must be an integer.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('wastage') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('wastage')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Norms -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="norms" label="Norms *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['norms'].invalid && (f['norms'].dirty || f['norms'].touched) && mode !== 'read'">
              <small *ngIf="f['norms'].errors?.['required']">Norms are required.</small>
              <small *ngIf="f['norms'].errors?.['min']">Norms must be >= 0.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('norms') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('norms')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Total Weight (readonly) -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="totalWeight" label="Total Weight" label-placement="floating" readonly>
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="hasServerError('totalWeight') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('totalWeight')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Cavity -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" formControlName="cavity" label="Cavity *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['cavity'].invalid && (f['cavity'].dirty || f['cavity'].touched) && mode !== 'read'">
              <small *ngIf="f['cavity'].errors?.['required']">Cavity is required.</small>
              <small *ngIf="f['cavity'].errors?.['min']">Cavity must be >= 0.</small>
              <small *ngIf="f['cavity'].errors?.['pattern']">Cavity must be an integer.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('cavity') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('cavity')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Shot Rate -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="shotRate" label="Shot Rate *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['shotRate'].invalid && (f['shotRate'].dirty || f['shotRate'].touched) && mode !== 'read'">
              <small *ngIf="f['shotRate'].errors?.['required']">Shot Rate is required.</small>
              <small *ngIf="f['shotRate'].errors?.['min']">Shot Rate must be >= 0.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('shotRate') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('shotRate')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Rate -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="rate" label="Rate (Price) *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['rate'].invalid && (f['rate'].dirty || f['rate'].touched) && mode !== 'read'">
              <small *ngIf="f['rate'].errors?.['required']">Rate is required.</small>
              <small *ngIf="f['rate'].errors?.['min']">Rate must be >= 0.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('rate') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('rate')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Incentive Limit -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" formControlName="incentiveLimit" label="Incentive Limit *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['incentiveLimit'].invalid && (f['incentiveLimit'].dirty || f['incentiveLimit'].touched) && mode !== 'read'">
              <small *ngIf="f['incentiveLimit'].errors?.['required']">Incentive Limit is required.</small>
              <small *ngIf="f['incentiveLimit'].errors?.['min']">Incentive Limit must be >= 0.</small>
              <small *ngIf="f['incentiveLimit'].errors?.['pattern']">Incentive Limit must be an integer.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('incentiveLimit') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('incentiveLimit')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Production Shot Qty -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" formControlName="productionShotQty" label="Production Shot Qty (shots) *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['productionShotQty'].invalid && (f['productionShotQty'].dirty || f['productionShotQty'].touched) && mode !== 'read'">
              <small *ngIf="f['productionShotQty'].errors?.['required']">Production Shot Qty is required.</small>
              <small *ngIf="f['productionShotQty'].errors?.['min']">Production Shot Qty must be >= 0.</small>
              <small *ngIf="f['productionShotQty'].errors?.['pattern']">Production Shot Qty must be an integer.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('productionShotQty') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('productionShotQty')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- Per Hour Prod. Qty -->
        <ion-row>
          <ion-col size="12">
            <ion-item fill="outline" class="ion-margin-bottom">
              <ion-input type="number" step="any" formControlName="perHourProdQty" label="Per Hour Prod. Qty *" label-placement="floating" [readonly]="mode === 'read'"></ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="f['perHourProdQty'].invalid && (f['perHourProdQty'].dirty || f['perHourProdQty'].touched) && mode !== 'read'">
              <small *ngIf="f['perHourProdQty'].errors?.['required']">Per Hour Prod. Qty is required.</small>
              <small *ngIf="f['perHourProdQty'].errors?.['min']">Per Hour Prod. Qty must be >= 0.</small>
            </ion-text>
            <ion-text color="danger" *ngIf="hasServerError('perHourProdQty') && mode !== 'read'">
              <small *ngFor="let message of getServerErrorMessages('perHourProdQty')">{{ message }}</small>
            </ion-text>
          </ion-col>
        </ion-row>

        <!-- CREATE / UPDATE MODE -->
        <ion-row class="ion-margin-top ion-margin-bottom action-row" *ngIf="mode !== 'read'">
          <ion-col size="6">
            <ion-button expand="block" type="submit" color="primary" [disabled]="productForm.invalid">
              <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
              {{ mode === 'create' ? 'Submit' : 'Update' }}
            </ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button color="medium" fill="outline" expand="block" (click)="goBack()">
              <ion-icon name="close-circle-outline" slot="start"></ion-icon>
              Cancel
            </ion-button>
          </ion-col>
        </ion-row>

        <!-- READ MODE: Back Button -->
        <ion-row class="ion-margin-top ion-margin-bottom action-row" *ngIf="mode === 'read'">
          <ion-col size="12">
            <ion-button color="medium" fill="outline" expand="block" (click)="goBack()">
              <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
              Back
            </ion-button>
          </ion-col>
        </ion-row>

        </ion-grid>
      </form>
    </ion-card-content>
  </ion-card>
</ion-content>
<app-footer></app-footer>
